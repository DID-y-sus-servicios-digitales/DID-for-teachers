<!DOCTYPE html>
<html>
<head>
    <title>Quiz Interactivo</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <style>
      body {
        background-color: #121212;
        color: #00ffff;
        font-family: sans-serif;
      }
      .container {
        width: 80%;
        margin: auto;
        padding: 20px;
      }
      #quizContent {
        border: 1px solid #00ffff;
        padding: 20px;
        margin-top: 20px;
      }
      .question {
        margin-bottom: 20px;
      }
      .answer-option {
        margin-bottom: 10px;
        cursor: pointer;
        color: #fff;
      }
      .answer-option:hover {
        color: #0ff;
      }
      .selected-answer {
        color: #0f0;
        font-weight: bold;
      }
      .correct-answer {
        color: #0f0;
        font-weight: bold;
      }
      .wrong-answer {
        color: #f00;
        font-weight: bold;
      }
      button {
        background-color: #00ffff;
        color: #121212;
        border: none;
        padding: 10px 20px;
        cursor: pointer;
        margin-top: 20px;
      }
      button:disabled {
        background-color: #404040;
        color: #808080;
        cursor: not-allowed;
      }
    </style>
</head>
<body>
    <div class="container">
        <h1>Quiz</h1>
        <div id="quizContent">
            <p>Cargando quiz...</p>
        </div>
    </div>
    <script>
        // Inicializa Firebase (reemplaza con tu configuración)
        const firebaseConfig = {
            apiKey: "AIzaSyDazGuaXHMpXo-5JDbYfQ8UVDxigrvGqA0",
  authDomain: "quizz-creator-did.firebaseapp.com",
  databaseURL: "https://quizz-creator-did-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "quizz-creator-did",
  storageBucket: "quizz-creator-did.firebasestorage.app",
  messagingSenderId: "837330124145",
  appId: "1:837330124145:web:b2c71134e0440364f90ad0
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Obtiene el ID del quiz de la URL
        const urlParams = new URLSearchParams(window.location.search);
        const quizId = urlParams.get('id');

        const quizContentDiv = document.getElementById('quizContent');
        let quizData;
        let userAnswers = {};
        let score = 0;
        let currentQuestionIndex = 0;


        if (quizId) {
            // Recupera el quiz de Firebase
            db.collection('quizzes').doc(quizId).get()
                .then((doc) => {
                    if (doc.exists) {
                        quizData = doc.data();
                        console.log("Datos del Quiz:", quizData);
                        displayQuestion(currentQuestionIndex); // Mostrar la primera pregunta
                    } else {
                        quizContentDiv.innerHTML = '<p>Quiz no encontrado.</p>';
                    }
                })
                .catch((error) => {
                    console.error("Error al obtener el quiz:", error);
                    quizContentDiv.innerHTML = '<p>Error al cargar el quiz.</p>';
                });
        } else {
            quizContentDiv.innerHTML = '<p>ID de quiz no proporcionado en la URL.</p>';
        }

      function displayQuestion(questionIndex) {
        const question = quizData.questions[questionIndex];
        let questionHTML = `<div class="question">
                            <p>Pregunta ${questionIndex + 1} (${question.type}): ${question.question}</p>`;

        if (question.type === 'multiple') {
            question.answers.forEach((answer, i) => {
                const answerId = `q${questionIndex}-a${i}`;
                questionHTML += `<div class="answer-option ${userAnswers[questionIndex] === i ? 'selected-answer' : ''}"
                                    id="${answerId}"
                                    onclick="selectAnswer(${questionIndex}, ${i})">
                                    ${answer}
                                </div>`;
            });
        } else if (question.type === 'verdadero/falso') {
                questionHTML += `<div class="answer-option ${userAnswers[questionIndex] === 0 ? 'selected-answer' : ''}"
                                  id="q${questionIndex}-a0"
                                   onclick="selectAnswer(${questionIndex}, 0)">
                                    Verdadero
                                  </div>
                                  <div class="answer-option ${userAnswers[questionIndex] === 1 ? 'selected-answer' : ''}"
                                   id="q${questionIndex}-a1"
                                    onclick="selectAnswer(${questionIndex}, 1)">
                                    Falso
                                   </div>`;
        } else if (question.type === 'escribir') {
          questionHTML += `<input type="text" id="q${questionIndex}-input" 
                            placeholder="Escribe tu respuesta" 
                            value="${userAnswers[questionIndex] || ''}"
                            onchange="handleInputChange(${questionIndex}, this.value)">`;
        }

        questionHTML += `</div>`;
        if (questionIndex < quizData.questions.length - 1){
          questionHTML += `<button onclick="nextQuestion()" id="nextButton" disabled>Siguiente</button>`;
        }
        else{
          questionHTML += `<button onclick="showResults()" id="nextButton" disabled>Ver Resultados</button>`;
        }


        quizContentDiv.innerHTML = questionHTML;

        // Si ya se respondió, habilitar el botón
        if (userAnswers[questionIndex] !== undefined) {
          document.getElementById("nextButton").disabled = false;
        }
      }

      function handleInputChange(questionIndex, value) {
        userAnswers[questionIndex] = value;
        document.getElementById("nextButton").disabled = false;

      }

      function selectAnswer(questionIndex, answerIndex) {
          userAnswers[questionIndex] = answerIndex;
          displayQuestion(questionIndex); // Volver a mostrar la pregunta para actualizar la selección
          document.getElementById("nextButton").disabled = false; // Habilitar el botón Siguiente
      }

      function nextQuestion() {
          if (currentQuestionIndex < quizData.questions.length - 1) {
              currentQuestionIndex++;
              displayQuestion(currentQuestionIndex);
          }
      }

      function showResults() {
          score = 0;
          let resultsHTML = '<h2>Resultados</h2>';
          quizData.questions.forEach((question, index) => {
              resultsHTML += `<div class="question">
                                  <p>Pregunta ${index + 1}: ${question.question}</p>`;
              const userAnswer = userAnswers[index];
              if (question.type === 'multiple' || question.type === 'verdadero/falso') {
                const correctAnswerIndex = question.correctAnswer; // Suponemos que tienes esto en tus datos
                if (userAnswer === correctAnswerIndex) {
                    resultsHTML += `<p>Tu respuesta: <span class="correct-answer">${question.answers[userAnswer]}</span></p>`;
                    resultsHTML += `<p>Respuesta Correcta: <span class="correct-answer">${question.answers[correctAnswerIndex]}</span></p>`;
                    score++;
                } else {
                    resultsHTML += `<p>Tu respuesta: <span class="wrong-answer">${userAnswer !== undefined ? question.answers[userAnswer] : 'No respondido'}</span></p>`;
                     resultsHTML += `<p>Respuesta Correcta: <span class="correct-answer">${question.answers[correctAnswerIndex]}</span></p>`;
                }
              }
              else{
                const correctAnswer = question.answers[0];
                if (userAnswer.toLowerCase() === correctAnswer.toLowerCase())
                {
                  resultsHTML += `<p>Tu respuesta: <span class="correct-answer">${userAnswer}</span></p>`;
                  resultsHTML += `<p>Respuesta Correcta: <span class="correct-answer">${correctAnswer}</span></p>`;
                  score++;
                }
                else{
                  resultsHTML += `<p>Tu respuesta: <span class="wrong-answer">${userAnswer || 'No respondido'}</span></p>`;
                  resultsHTML += `<p>Respuesta Correcta: <span class="correct-answer">${correctAnswer}</span></p>`;
                }
              }

              resultsHTML += `</div>`;
          });
          resultsHTML += `<p>Puntuación: ${score} / ${quizData.questions.length}</p>`;
          quizContentDiv.innerHTML = resultsHTML;
      }
    </script>
</body>
</html>

