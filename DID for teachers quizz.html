<!DOCTYPE html>
<html>
<head>
    <title>Quiz Interactivo</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <style>
      body {
        background-color: #121212;
        color: #00ffff;
        font-family: sans-serif;
      }
      .container {
        width: 80%;
        margin: auto;
        padding: 20px;
      }
      #quizContent {
        border: 1px solid #00ffff;
        padding: 20px;
        margin-top: 20px;
      }
      .question {
        margin-bottom: 20px;
      }
      .answer-option {
        margin-bottom: 10px;
        cursor: pointer;
        color: #fff;
      }
      .answer-option:hover {
        color: #0ff;
      }
      .selected-answer {
        color: #0f0;
        font-weight: bold;
      }
      .correct-answer {
        color: #0f0;
        font-weight: bold;
      }
      .wrong-answer {
        color: #f00;
        font-weight: bold;
      }
      button {
        background-color: #00ffff;
        color: #121212;
        border: none;
        padding: 10px 20px;
        cursor: pointer;
        margin-top: 20px;
      }
      button:disabled {
        background-color: #404040;
        color: #808080;
        cursor: not-allowed;
      }
    </style>
</head>
<body>
    <div class="container">
        <h1>Quiz</h1>
        <div id="quizContent">
            <p>Cargando quiz...</p>
        </div>
    </div>
    <script>
const questions = [];
const questionsDiv = document.getElementById('questions');
const previewArea = document.getElementById('previewArea');
const newQuestionButton = document.getElementById('newQuestion');
const questionTypeModal = document.getElementById('questionTypeModal');
const modalClose = document.querySelector('.close');
const modalButtons = document.querySelectorAll('.modal-content button');
const quizLink = document.getElementById('quizLink');

// Inicializa Firebase (Reemplaza con tu configuración)
const firebaseConfig = {
    apiKey: "AIzaSyDazGuaXHMpXo-5JDbYfQ8UVDxigrvGqA0",
  authDomain: "quizz-creator-did.firebaseapp.com",
  databaseURL: "https://quizz-creator-did-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "quizz-creator-did",
  storageBucket: "quizz-creator-did.firebasestorage.app",
  messagingSenderId: "837330124145",
  appId: "1:837330124145:web:b2c71134e0440364f90ad0
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const dynamicLinks = firebase.dynamicLinks();  // Inicializa Dynamic Links


newQuestionButton.addEventListener('click', () => {
    questionTypeModal.style.display = "block";
});

modalClose.onclick = function () {
    questionTypeModal.style.display = "none";
}

window.onclick = function (event) {
    if (event.target == questionTypeModal) {
        questionTypeModal.style.display = "none";
    }
}

modalButtons.forEach(button => {
    button.addEventListener('click', () => {
        const type = button.dataset.type;
        questionTypeModal.style.display = "none";
        const question = { type, question: '', answers: [] };
        if (type === 'multiple') {
            question.answers = ['', '', '', ''];
        } else if (type === 'verdadero/falso') {
            question.answers = ['', ''];
        }
        questions.push(question);
        renderQuestions();
        renderPreview();
    });
});



function renderQuestions() {
    questionsDiv.innerHTML = questions.map((q, index) => `
      <div class="question">
        <p>Pregunta ${index + 1} (${q.type})</p>
        <input type="text" placeholder="Escribe la pregunta aquí" value="${q.question}" onchange="updateQuestion(${index}, 'question', this.value)">
        ${q.type === 'multiple' ? `
          <input type="text" placeholder="Opción 1" value="${q.answers[0] || ''}" onchange="updateAnswer(${index}, 0, this.value)">
          <input type="text" placeholder="Opción 2" value="${q.answers[1] || ''}" onchange="updateAnswer(${index}, 1, this.value)">
          <input type="text" placeholder="Opción 3" value="${q.answers[2] || ''}" onchange="updateAnswer(${index}, 2, this.value)">
          <input type="text" placeholder="Opción 4" value="${q.answers[3] || ''}" onchange="updateAnswer(${index}, 3, this.value)">
        ` : ''}
        ${q.type === 'verdadero/falso' ? `
          <input type="text" placeholder="Verdadero" value="${q.answers[0] || ''}" onchange="updateAnswer(${index}, 0, this.value)">
          <input type="text" placeholder="Falso" value="${q.answers[1] || ''}" onchange="updateAnswer(${index}, 1, this.value)">
        ` : ''}
        ${q.type === 'escribir' ? `
          <input type="text" placeholder="Respuesta correcta" value="${q.answers[0] || ''}" onchange="updateAnswer(${index}, 0, this.value)">
        ` : ''}
      </div>
    `).join('');
}

function updateQuestion(index, field, value) {
    questions[index][field] = value;
    renderPreview();
}

function updateAnswer(questionIndex, answerIndex, value) {
    questions[questionIndex].answers[answerIndex] = value;
    renderPreview();
}

function renderPreview() {
    let previewHTML = questions.map(q => {
        let answersDisplay = '';
        if (q.type === 'multiple') {
            answersDisplay = `<p>Opciones: ${q.answers.filter(a => a).join(', ')}</p>`;
        } else if (q.type === 'verdadero/falso') {
            answersDisplay = `<p>Opciones: Verdadero, Falso</p>`;
        } else if (q.type === 'escribir') {
            answersDisplay = `<p>Respuesta: ${q.answers.filter(a => a).join(', ')}</p>`;
        }
        return `<div style="margin-bottom: 10px; border: 1px solid #00ffff; padding: 5px;">${q.question} ${answersDisplay}</div>`;
    }).join('');
    previewArea.innerHTML = previewHTML;
}

document.getElementById('generate').addEventListener('click', () => {
    generateDynamicLink()
        .then(link => {
            quizLink.href = link;
            quizLink.textContent = link;
            alert(`Enlace generado. ¡Compártelo con tus estudiantes!`);
        })
        .catch(error => {
            console.error("Error al generar el enlace dinámico:", error);
            alert("Error al generar el enlace. Por favor, inténtalo de nuevo.");
        });
});


function generateDynamicLink() {
  return new Promise((resolve, reject) => {
    const base_url = "https://did-for-teachers.github.io/quiz"; // Tu dominio de GitHub Pages
    const quiz_id = Math.random().toString(36).substring(2, 15);
    const full_link = `${base_url}?id=${quiz_id}`;

    // Guarda el quiz en Firestore
    db.collection('quizzes').doc(quiz_id).set({
        questions: questions
    }).then(() => {
      console.log("Quiz guardado en Firestore con ID:", quiz_id);

        // Crea el enlace dinámico
        dynamicLinks.createShortDynamicLink({
            destination: full_link, //  La URL completa
            domainUriPrefix: 'https://didforteachers.page.link',  //  Tu dominio de Dynamic Links
            androidParameters: {
              packageName: 'com.example.android',  //  Nombre de paquete de tu app Android (si tienes)
            },
            iosParameters: {
              bundleId: 'com.example.ios',  //  Bundle ID de tu app iOS (si tienes)
            },
            socialMetaTagParameters: {
                title: 'Quiz para Estudiantes',
                description: 'haz este quizz',
                imageUrl: 'https://www.example.com/quiz_image.jpg', //  Una imagen para compartir en redes sociales
            },
        }).then(shortLink => {
            if (shortLink) {
                console.log("Enlace dinámico corto generado:", shortLink.shortUrl);
                resolve(shortLink.shortUrl);
            } else {
                reject("No se pudo generar el enlace corto.");
            }
        }).catch(error => {
            console.error("Error al crear el enlace dinámico:", error);
            reject(error);
        });
    }).catch(error => {
        console.error("Error al guardar el quiz en Firestore:", error);
        reject(error);
    });
  });
}
</script>


</body>
</html>

