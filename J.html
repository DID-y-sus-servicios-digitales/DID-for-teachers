<!DOCTYPE html>
<html>
<head>
    <link rel="icon" type="image/png" sizes="16x16"  href="st.png">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="theme-color" content="#121212">
<title>Quizz studio beta</title>
<style>
body {
    background-color: #121212;
    color: #00ffff;
    font-family: sans-serif;
}

.container {
    width: 80%;
    margin: auto;
    padding: 20px;
}

.question {
    border: 1px solid #00ffff;
    padding: 10px;
    margin-bottom: 10px;
}

.preview {
    border: 1px solid #00ffff;
    padding: 10px;
    margin-top: 20px;
}

button {
    background-color: #00ffff;
    color: #121212;
    border: none;
    padding: 10px 20px;
    cursor: pointer;
    margin-right: 10px;
}

select {
    background-color: #00ffff;
    color: #121212;
    border: none;
    padding: 5px 10px;
    margin-bottom: 10px;
}

input[type="text"] {
    background-color: #1f1f1f;
    color: #00ffff;
    border: 1px solid #00ffff;
    padding: 5px;
    margin-bottom: 5px;
    width: 100%;
}

.modal {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.4);
}

.modal-content {
    background-color: #1f1f1f;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #00ffff;
    width: 50%;
    text-align: center;
}

.modal-content button {
    margin: 10px;
}

.close {
    color: #00ffff;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

.close:hover,
.close:focus {
    color: #fff;
    text-decoration: none;
}

#quizLink {
    color: #0ff;
    text-decoration: underline;
}

#quizLink:hover {
    color: #ff0;
    cursor: pointer;
}
</style>
</head>
<body>

<div class="container">
    <h1>Quizz studio [beta]</h1>
    <div id="questions"></div>
    <button id="newQuestion">Nueva Pregunta</button>
    <div class="preview">
        <h2>Vista Previa</h2>
        <div id="previewArea"></div>
        <p>
            Enlace para compartir: <a id="quizLink" href=""></a>
        </p>
    </div>
    <button id="generate">Generar Enlace</button>

    <div id="questionTypeModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <p>Seleccione el tipo de pregunta:</p>
            <button data-type="multiple">Opción Múltiple</button>
            <button data-type="verdadero/falso">Verdadero/Falso</button>
            <button data-type="escribir">Escribir</button>
        </div>
    </div>

</div>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<script>
    const preguntas = JSON.parse(localStorage.getItem("preguntas")) || [];
    const MAX_PREGUNTAS = 16;
    const UN_MES = 30 * 24 * 60 * 60 * 1000;

    const preguntaElemento = document.getElementById("pregunta");
    const opcionesElemento = document.getElementById("opciones");
    const respuestaEscritaInput = document.getElementById("respuesta-escrita");
    const siguienteBtn = document.getElementById("siguiente-btn");
    const resultadosElemento = document.getElementById("resultados");
    const puntuacionElemento = document.getElementById("puntuacion");
    const crearQuiz = document.getElementById("crear-quiz");
    const realizarQuiz = document.getElementById("realizar-quiz");
    const tipoPreguntaSelect = document.getElementById("tipo-pregunta");
    const opcion1Input = document.getElementById("opcion1");
    const opcion2Input = document.getElementById("opcion2");
    const opcion3Input = document.getElementById("opcion3");
    const opcion4Input = document.getElementById("opcion4");
    const agregarPreguntaBtn = document.getElementById("agregar-pregunta-btn");
    const generarEnlaceBtn = document.getElementById("generar-enlace-btn");
    const enlaceModal = document.getElementById("enlace-modal");
    const enlaceInput = document.getElementById("enlace-input");
    const copiarEnlaceBtn = document.getElementById("copiar-enlace-btn");
    const cerrarModalBtn = document.querySelector(".cerrar-modal-btn");


    let preguntaActual = 0;
    let puntuacion = 0;
    let quizId = localStorage.getItem("quizId") || generateQuizId();

    function generateQuizId() {
        const id = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
        localStorage.setItem("quizId", id);
        return id;
    }

    function cargarPregunta() {
        if (!preguntas || preguntas.length === 0) {
            preguntaElemento.textContent = "No hay preguntas disponibles. Por favor, crea un quiz.";
            opcionesElemento.innerHTML = "";
            siguienteBtn.classList.add("oculto");
            return;
        }

        const pregunta = preguntas[preguntaActual];
        preguntaElemento.textContent = pregunta.pregunta;
        opcionesElemento.innerHTML = "";
        respuestaEscritaInput.classList.add("oculto");

        if (pregunta.tipo === "multiple" || pregunta.tipo === "verdadero-falso") {
            pregunta.opciones.forEach(opcion => {
                const li = document.createElement("li");
                li.textContent = opcion;
                li.addEventListener("click", () => seleccionarRespuesta(opcion));
                opcionesElemento.appendChild(li);
            });
        } else if (pregunta.tipo === "escrita") {
            respuestaEscritaInput.classList.remove("oculto");
        }

        siguienteBtn.classList.remove("oculto");
    }

    function seleccionarRespuesta(respuesta) {
        const pregunta = preguntas[preguntaActual];
        let respuestaUsuario;

        if (pregunta.tipo === "multiple" || pregunta.tipo === "verdadero-falso") {
            respuestaUsuario = respuesta;
        } else if (pregunta.tipo === "escrita") {
            respuestaUsuario = respuestaEscritaInput.value.trim();
        }

        if (respuestaUsuario.toLowerCase() === pregunta.respuestaCorrecta.toLowerCase()) {
            puntuacion++;
        }

        if (preguntaActual < preguntas.length - 1) {
            preguntaActual++;
            cargarPregunta();
        } else {
            mostrarResultados();
        }
    }

    function mostrarResultados() {
        preguntaElemento.classList.add("oculto");
        opcionesElemento.classList.add("oculto");
        respuestaEscritaInput.classList.add("oculto");
        siguienteBtn.classList.add("oculto");
        resultadosElemento.classList.remove("oculto");
        puntuacionElemento.textContent = `Tu puntuación es: ${puntuacion}/${preguntas.length}`;
        realizarQuiz.style.display = "block";
    }

    siguienteBtn.addEventListener("click", () => {
        if (preguntas && preguntas.length > 0) {
            if (preguntaActual === 0) {
                cargarPregunta();
            }
        }
    });


    tipoPreguntaSelect.addEventListener("change", () => {
        const tipo = tipoPreguntaSelect.value;
        opcion1Input.placeholder = tipo === "escrita" ? "Respuesta" : "Opción 1";
        opcion2Input.placeholder = tipo === "escrita" ? "" : "Opción 2";
        opcion3Input.placeholder = tipo === "escrita" ? "" : "Opción 3";
        opcion4Input.placeholder = tipo === "escrita" ? "" : "Opción 4";

        opcion2Input.style.display = tipo === "escrita" ? "none" : "block";
        opcion3Input.style.display = tipo === "escrita" ? "none" : "block";
        opcion4Input.style.display = tipo === "escrita" ? "none" : "block";
    });

    agregarPreguntaBtn.addEventListener("click", () => {
        const tipoPregunta = tipoPreguntaSelect.value;
        const nuevaPregunta = document.getElementById("nueva-pregunta").value.trim();
        const opcion1 = opcion1Input.value.trim();
        const opcion2 = opcion2Input.value.trim();
        const opcion3 = opcion3Input.value.trim();
        const opcion4 = opcion4Input.value.trim();
        const respuestaCorrecta = document.getElementById("respuesta-correcta").value.trim();

        if (preguntas.length < MAX_PREGUNTAS) {
            let opciones = [];
            if (tipoPregunta === "multiple" || tipoPregunta === "verdadero-falso") {
                if (!opcion1 || !opcion2 || !respuestaCorrecta) {
                    alert("Por favor, ingrese las opciones y la respuesta correcta")
                    return;
                }
                opciones = [opcion1, opcion2, opcion3, opcion4].filter(Boolean);
                if (tipoPregunta === "verdadero-falso") {
                    opciones = ["Verdadero", "Falso"];
                }
            } else if (tipoPregunta === "escrita") {
                if (!nuevaPregunta || !respuestaCorrecta) {
                    alert("Por favor, ingrese la pregunta y la respuesta correcta.");
                    return;
                }
            } else {
                if (!nuevaPregunta || !respuestaCorrecta || !opcion1 || !opcion2) {
                    alert("Por favor, ingrese la pregunta y al menos dos opciones y la respuesta correcta.");
                    return;
                }
                opciones = [opcion1, opcion2, opcion3, opcion4].filter(Boolean);
            }

            preguntas.push({
                tipo: tipoPregunta,
                pregunta: nuevaPregunta,
                opciones: opciones,
                respuestaCorrecta: respuestaCorrecta,
                timestamp: Date.now()
            });

            localStorage.setItem("preguntas", JSON.stringify(preguntas));
            alert("Pregunta agregada correctamente");
            limpiarFormulario();

        } else {
            alert("Se ha alcanzado el máximo de 16 preguntas.");
        }
    });

    function limpiarFormulario() {
        document.getElementById("nueva-pregunta").value = "";
        opcion1Input.value = "";
        opcion2Input.value = "";
        opcion3Input.value = "";
        opcion4Input.value = "";
        document.getElementById("respuesta-correcta").value = "";
        tipoPreguntaSelect.value = "multiple";

        opcion2Input.style.display = "block";
        opcion3Input.style.display = "block";
        opcion4Input.style.display = "block";
    }

    generarEnlaceBtn.addEventListener("click", () => {
        if (preguntas.length > 0) {
            const quizURL = `${window.location.origin}${window.location.pathname}?quizId=${quizId}`;
            enlaceInput.value = quizURL;
            enlaceModal.style.display = "block";

        } else {
            alert("Por favor, agrega preguntas antes de generar un enlace.");
        }
    });

    cerrarModalBtn.addEventListener("click", () => {
        enlaceModal.style.display = "none";
    });

    copiarEnlaceBtn.addEventListener("click", () => {
        enlaceInput.select();
        enlaceInput.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(enlaceInput.value);
        alert("Enlace copiado al portapapeles");
        enlaceModal.style.display = "none";
    });

    function getQuizIdFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get("quizId");
    }

    const urlQuizId = getQuizIdFromURL();
    if (urlQuizId) {
        const savedQuizIdData = localStorage.getItem("quizIdData");
        let quizIdData = savedQuizIdData ? JSON.parse(savedQuizIdData) : {};

        if (quizIdData[urlQuizId]) {
            const tiempoCreacion = quizIdData[urlQuizId].timestamp;
            const tiempoExpiracion = tiempoCreacion + UN_MES;

            if (Date.now() > tiempoExpiracion) {
                alert("Este enlace ha caducado.");
                localStorage.removeItem("quizIdData");
                localStorage.removeItem("preguntas");
                crearQuiz.style.display = "block";
                realizarQuiz.style.display = "none";
            } else {
                crearQuiz.style.display = "none";
                realizarQuiz.style.display = "block";
                preguntas = preguntas.filter(pregunta => pregunta.timestamp <= tiempoExpiracion);
                localStorage.setItem("preguntas", JSON.stringify(preguntas));
                cargarPregunta();
            }
        } else {
            alert("Este enlace no es válido o el quiz ya no está disponible.");
            crearQuiz.style.display = "block";
            realizarQuiz.style.display = "none";
        }
    } else {
        crearQuiz.style.display = "block";
        realizarQuiz.style.display = "none";
    }
</script>


</body>
</html>

